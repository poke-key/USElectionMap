@page "/election-map"
@inject IJSRuntime JSRuntime
@inject ElectionDataService ElectionDataService

<h3>US Election Map</h3>

<div class="year-selector">
    <label for="year-select">Select Year: </label>
    <select id="year-select" @bind="SelectedYear" @bind:after="LoadData">
        @foreach (var year in Years)
        {
            <option value="@year">@year</option>
        }
    </select>
</div>

<div id="map" style="height: 600px; width: 100%;"></div>

@code {
    private List<int> Years = new List<int> { 2000, 2004, 2008, 2012, 2016, 2020 };
    private int SelectedYear = 2020;
    private List<ElectionResult> electionData;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("initializeMap");
            await LoadData();
        }
    }

    private async Task LoadData()
    {
        electionData = await ElectionDataService.GetElectionDataAsync(SelectedYear);
        await JSRuntime.InvokeVoidAsync("updateMap", electionData);
    }
}